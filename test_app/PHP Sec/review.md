# PHP App ② レビュー

## XSS(クロスサイトスクリプティング)

### XSSとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
- wedアプリケーションのセキュリティ脆弱性の一つで、悪意あるユーザーが他のユーザーに対して意図しないスクリプトを実行させることができる。
wedページに挿入しそのページを閲覧したユーザーに実行させる攻撃方法です。
メリットは多くのユーザーに影響を与えユーザーのcookie情報を盗んだり、不正な操作を行うことができる。スクリプトを挿入するだけなので簡単に実行ができること、リモートで行えることから特定されにくい点です。

### `htmlspecialchars()`を`e()`として定義しなおすメリットを説明してください。
- e()として定義する理由として、
チーム開発やプロジェクト全体でのエスケープ処理を統一できる。
他のエスケープ処理を使いたい場合でもe()の中で一元管理できる。
e()の中で高度なエスケープ処理を実装したりHtmlspecialchars()関数以外に変更したくなった場合でもe()　の定義を変更するだけで全体のコードに影響を与えることなくエスケープ処理を更新できる。

### `htmlspecialchars()`を使うことでなぜXSSが防げるのか説明してください。
- Htmlspecialchars()関数の（エスケープ処理する文字列、エスケープ処理の種類、文字コード）で第二引数にENT_QUOTESのエスケープ処理の種類を指定する。
これにより、（スクリプトタグが）特殊文字が（'、"、<、>、&など）をエスケープして表示するため挿入しようとしたスクリプトがそのままＨＴＭＬとして解釈されないようにされ文字列として扱われる。

## CSRF(クロスサイトリクエストフォージェリ)

### CSRFとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
- 攻撃は不特定多数の人に対してWebサイトにログインしていることを利用して行われセッション情報やクッキーを不正に使用してユーザーが意図しない操作を引き起こす攻撃のこと。
攻撃をしたユーザーの権限での操作が可能となりログイン状態を利用してパスワード変更や金銭の送付などを行える。
また正規でのリクエストと見分けがつきにくいため、システムの不審なアクセスとして認識されにくいことがあげられる。

### SessionとCookieの違いを説明してください。
セッション（SESSION）
サーバ側でデータが保存される。
ユーザーごとにセクションIDがサーバに生成され。ユーザーの状態や情報を管理している。
サーバで管理されているためセキュリティが高いのでデータの改ざんや盗難のリスクが少ない。ログイン状態や、カートの中身など常に変化する情報を保持するのに向いている。
セッションIDの有効期限があり、ブラウザを閉じると終了することが多いのと、一定期間の操作がないとタイムアウト刷ることがある。

クッキー（COOKIE）
ユーザーのブラウザにデータが保存される。
Webサイトはクライアントにクッキーを送信しそれがブラウザに保存される。
クッキーには有効期限を指定することができるため、ユーザー情報を長期間保存したい場合などに適している。
セキュリティのリスクがある。クッキーはクライアント側で保存されるためXSS攻撃や盗聴野リスクがある。

### `setToken()`が何をしているか説明してください。
- setToken()関数はCSRF攻撃を防ぐための関数です。
一意のトークンを生成でランダムなトークンを生成します。
セッションに保存、生成したトークンをサーバ側に一時保存します。
このトークンをフォームに隠しフィールドして入れ送信時に一緒に送信します。
送信されたトークンをサーバに保存されたものと比較しそれが正しいものかの確認をします。不正なリクエストを防ぎます。

### `checkToken()`が何をしているか説明してください。
- checkToken()関数はTokenの値を検証するために用いられる。
サーバ側に保存されている正しいトークンと
POSTされたトークンを比較し一致すればリクエストが正当なものであることを確認します。
トークンが一致しない場合は不正なリクエスト（CSRF攻撃）である可能性が高い
リクエストが拒否するような処理を行う
＄POST［’token’］はユーザーがフォームを送信した際に一緒に送信されるトークンです。

### トークンを使うことでなぜCSRFが防げるのか説明してください。
- トークンは一意であり、ユーザーしか持たない情報です。このトークンはブラウザとサーバー間で共有され、攻撃者はユーザーのリクエストに対応する一意のトークンを知りません。そのため、正しいトークンがない限り、リクエストはサーバーに拒否され、CSRF攻撃を防ぐことができます。


## SQLインジェクション

### SQLインジェクションとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
- SQLインジェクションはアプリケーションのセキュリティの不備を利用して、データベースに本来意図されないSQL文を実行させる攻撃でありTRUNCATE TABLE テーブル名;
のSQL文を作成した場合に全削除するという命令を実行してしまう。
攻撃者のメリットは情報の取得、データの改ざんや削除などができる。

### `->prepare()`の返り値と、またこのメソッドが何をしているか説明してください。
- prepare()メソッドの返り値はPDOstatementオブジェクトを返します。 
prepare()メソッドはSQL文を受け取り、まだ値がない状態のSQL文をデータベースに送ります。データを入れる前に下書きをつくる処理です。その後プレースホルダーを使い実際の値を後から安全に挿入できるように準備します。

### `->bindValue()`が何をしているか説明してください。
- bindValue()はPHPのPDOで使用されるメソッドで
SQLステートメントに対してパラメータをバインド（関連付け）するために使用されます。
これによりSQLインジェクションの防ぐことができます。
プレースホルダーには、第一引数に対象となるプレースホルダー（文字列、nameなど）、第二引数にバインドする値（$post['content']など）、第三引数に保存したい値のデータ型（PDO::PARAM_STRなど）を指定する。このように値を安全にセットします。

### 今回の対策でなぜSQLインジェクションが防げるのか説明してください。
- bindValue()メソッドやprepare()メソッドでプレースホルダーを使うと
SQL文に対してユーザーから入力されたデータが安全にエスケープされるため
攻撃者がＳＱＬを改変したり、不正なデータベースへの操作を行うことが難しくなります。
これによりユーザーの入力ＳＱＬ文が直接埋め込まれることなく正しく処理されます。

## バリデーション

### バリデーションの目的について説明してください。
- データが信頼できるものや整合性の確認をすることです。
ユーザーなどから送信されたデータが指定した形式や値になっているかの確認するために行います。具体的にはメールアドレスの入力欄に対してuser@mail.comの形式での入力指定があり、入力情報がuser@mailと入力されている場合にバリデーションが働きエラーメッセージが表示されます。

### `validate()`が何をしているか説明してください。
- Validate()関数は入力されたデータが指定された条件を満たしているかを確認します。
この関数によってデータの整合性が保たれること、適正なデータであるかの検証がされます。
条件を満たしていない場合にはエラーメッセージを表示することで、ユーザーに入力の修正を促します。
これにより、システムが安全性とデータの処理を行えます。

### `isset($post['content'])`はなぜ必要か、無い場合どうなるか説明してください。
- isset($post['content'])のチェックを行うことで
未定義のキーのアクセスとそれに伴うエラーを防ぐことができます。
意図しない動作を防ぐためにisset()関数を使用することが重要となります。
ある場合には、isset()関数を使うことで配列$postに['content]'キーが
存在するかの確認を行い、未定義のキーにアクセスするようなエラーを防ぐことができます。
ない場合には、$post['content']にアクセスすると未定義の配列キーのエラーが表示されます。
意図しない動作を引き起こす原因となります。

## その他

### `unsetError()`を実行しないとどうなるか説明してください。
- unsetError()関数を実行しないとエラーメッセージが表示されたままとなり、現在の問題が不明確な状態になります。
エラーが残っているため、ユーザーは何が問題か理解しづらく、問題の特定が難しくなりデバック作業に悪影響が出る可能性があります。
